--https://preppindata.blogspot.com/2023/01/2023-week-4-new-customers.html

WITH JANUARY AS (
    SELECT ID,
           CONCAT(JOINING_DAY, '/01/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_JANUARY
    GROUP BY ID, JOINING_DAY
),
FEBRUARY AS (
 SELECT ID,
           CONCAT(JOINING_DAY, '/02/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_FEBRUARY
    GROUP BY ID, JOINING_DAY),
  
MARCH AS (
 SELECT ID,
           CONCAT(JOINING_DAY, '/03/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_MARCH
    GROUP BY ID, JOINING_DAY),
APRIL AS (
 SELECT ID,
           CONCAT(JOINING_DAY, '/04/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_APRIL
    GROUP BY ID, JOINING_DAY),
MAY AS (
 SELECT ID,
           CONCAT(JOINING_DAY, '/05/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_MAY
    GROUP BY ID, JOINING_DAY),
JUNE AS (
 SELECT ID,
           CONCAT(JOINING_DAY, '/06/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_JUNE
    GROUP BY ID, JOINING_DAY),
JULY AS (
 SELECT ID,
           CONCAT(JOINING_DAY, '/07/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_JULY
    GROUP BY ID, JOINING_DAY),
    August_corrected as(
  select   ID,
JOINING_DAY,
DEMOGRAPHIIC AS DEMOGRAPHIC,
VALUE
FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_AUGUST),
AUGUST AS (
 SELECT ID,
           CONCAT(JOINING_DAY, '/08/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM August_corrected
    GROUP BY ID, JOINING_DAY),
SEPTEMBER AS (
 SELECT ID,
           CONCAT(JOINING_DAY, '/09/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_SEPTEMBER
    GROUP BY ID, JOINING_DAY),
   October_corrected as(
  select   ID,
JOINING_DAY,
DEMAGRAPHIC AS DEMOGRAPHIC,
VALUE
FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_OCTOBER),
OCTOBER AS (
 SELECT ID,
           CONCAT(JOINING_DAY, '/10/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM October_corrected
    GROUP BY ID, JOINING_DAY),
NOVEMBER AS (
 SELECT ID,
           CONCAT(JOINING_DAY, '/11/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_NOVEMBER
    GROUP BY ID, JOINING_DAY),
DECEMBER AS (
 SELECT ID,
           CONCAT(JOINING_DAY, '/12/2023') AS JOINING_DAY,
           MAX(CASE WHEN DEMOGRAPHIC = 'Ethnicity' THEN VALUE END) AS "Ethnicity",
           MAX(CASE WHEN DEMOGRAPHIC = 'Account Type' THEN VALUE END) AS "Account Type",
           MAX(CASE WHEN DEMOGRAPHIC = 'Date of Birth' THEN VALUE END) AS "Date of Birth"
    FROM TIL_PLAYGROUND.PREPPIN_DATA_INPUTS.PD2023_WK04_DECEMBER
    GROUP BY ID, JOINING_DAY),
UNIONED AS (
    SELECT * FROM JANUARY
    UNION ALL
    SELECT * FROM FEBRUARY
    UNION ALL
    SELECT * FROM MARCH
    UNION ALL
    SELECT * FROM APRIL
    UNION ALL
    SELECT * FROM MAY
    UNION ALL
    SELECT * FROM JUNE
    UNION ALL
    SELECT * FROM JULY
    UNION ALL
    SELECT * FROM AUGUST
    UNION ALL
    SELECT * FROM SEPTEMBER
    UNION ALL
    SELECT * FROM OCTOBER
    UNION ALL
    SELECT * FROM NOVEMBER
    UNION ALL
    SELECT * FROM DECEMBER
)

SELECT * FROM UNIONED;





